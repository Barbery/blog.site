<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>总结 on Barbery&#39;s Blog</title>
    <link>http://barbery.me/tags/%E6%80%BB%E7%BB%93/</link>
    <description>Recent content in 总结 on Barbery&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Sun, 19 Mar 2017 21:29:27 +0800</lastBuildDate>
    <atom:link href="http://barbery.me/tags/%E6%80%BB%E7%BB%93/feed/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>PHP高并发下问题总结</title>
      <link>http://barbery.me/post/2017-03-19-PHP-Summary-of-high-concurrency-issues/</link>
      <pubDate>Sun, 19 Mar 2017 21:29:27 +0800</pubDate>
      
      <guid>http://barbery.me/post/2017-03-19-PHP-Summary-of-high-concurrency-issues/</guid>
      <description>

&lt;p&gt;上周，我们搞了一个活动，没有预想到活动会那么火爆，最高峰的一天有6千万的PV，一周下来累计接近2.6亿的PV。
这么大的流量突然涌入，真是把我们杀个措手不及，最终还是要把接口往GO迁才能扛下来。其中也暴露出了不少问题。&lt;/p&gt;

&lt;h2 id=&#34;phpredis问题&#34;&gt;phpredis问题&lt;/h2&gt;

&lt;h3 id=&#34;超时问题&#34;&gt;超时问题&lt;/h3&gt;

&lt;p&gt;phpredis应该说是大家非常普遍使用的一个redis client，以往在单机redis下使用情况也非常稳定。但是非常遗憾的是，
在redis cluster模式下，phpredis非常不稳定，经常会出现超时的异常错误，例如：&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;RedisClusterException: Timed out attempting to find data in the correct node!&lt;/p&gt;

&lt;p&gt;ErrorException: RedisCluster::setex(): connect() failed: Connection timed out&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;第一个问题的话，是早期的phpredis的一个BUG，使用新的版本或者使用phpredis的develop分支就可以解决了。
我们使用了最新的develop分之后，第一个问题就没再出现了，转而是常常出现问题而这种连接超时的情况，
这个问题暂时不知道如何解决。&lt;/p&gt;

&lt;h3 id=&#34;redis集群负载不均问题&#34;&gt;redis集群负载不均问题&lt;/h3&gt;

&lt;p&gt;使用phpredis还有一个问题是，读取策略的问题，请使用&lt;code&gt;RedisCluster::FAILOVER_DISTRIBUTE_SLAVES&lt;/code&gt;的读取策略，
其他策略例如&lt;code&gt;RedisCluster::FAILOVER&lt;/code&gt;，或者&lt;code&gt;RedisCluster::FAILOVER_DISTRIBUTE&lt;/code&gt;，都会造成整个集群的负载非常不均衡。
使用&lt;code&gt;RedisCluster::FAILOVER&lt;/code&gt;的话会导致redis读写都会发送给redis master机器，导致master和slave负载不均，
如果使用&lt;code&gt;RedisCluster::FAILOVER_DISTRIBUTE&lt;/code&gt;虽然读会随机分发给master和slave，但是我们实际看到，slave机器负载和master的差异还是很大。
目前来看，使用&lt;code&gt;RedisCluster::FAILOVER_DISTRIBUTE_SLAVES&lt;/code&gt;的读取策略是最佳的选择，但是同一个节点下的多个slave机器之间还是会存在负载差异。&lt;/p&gt;

&lt;h3 id=&#34;性能损耗问题&#34;&gt;性能损耗问题&lt;/h3&gt;

&lt;p&gt;phpredis在cluster模式下，有个额外的性能损耗问题，就是每次创建连接的时候，都会去获取一次cluster slots, 而由于
每次获取这个slots都是从seeds里面循环去获取，直至获取到slots信息，所以&lt;code&gt;new RedisCluster(null, $servers)&lt;/code&gt;时，传入的servers中第一个会压力很大，
在高并发的情况下，频发的短链接创建，会直接导致redis集群负载不均，这也是导致了redis集群负载不均的一个原因。&lt;/p&gt;

&lt;h2 id=&#34;阿里云相关&#34;&gt;阿里云相关&lt;/h2&gt;

&lt;p&gt;连接不稳定&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;SQLSTATE[HY000] [2002] php_network_getaddresses: getaddrinfo failed: Name or service not known&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;坑爹阿里云，内网dns解析非常不稳定，大流量的情况下，连自家的RDS地址都不认了，解决办法：把IP地址写入host，缺点是，主从切换时需要手动更新IP。&lt;/p&gt;

&lt;h2 id=&#34;系统其他&#34;&gt;系统其他&lt;/h2&gt;

&lt;p&gt;增大nf_conntrack_max参数，可以增大服务器的并发数&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;sudo sysctl net.nf_conntrack_max=512000&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>2016年度总结</title>
      <link>http://barbery.me/post/2017-01-02-annual-summary/</link>
      <pubDate>Mon, 02 Jan 2017 22:24:44 +0800</pubDate>
      
      <guid>http://barbery.me/post/2017-01-02-annual-summary/</guid>
      <description>

&lt;h2 id=&#34;工作&#34;&gt;工作&lt;/h2&gt;

&lt;p&gt;今年4月，我放弃了我梦寐以求的remote工作，被朋友拉入了一家创业公司，又重新回到苦逼的加班日子。
我的remote生涯只持续了半年，崇尚自由的我，怎么也没想到我自己会这么果断的离开了remote的生活。
周围的朋友都会问我为什么，答案说出来也有点自我打脸，原因就是工作太清闲了。一天的remote工作，大多数
情况下，基本上只需要2-4个小时就可以完成了。早上10点懒洋洋起床，简单开下早会，边工作边吃早餐，
基本上12点左右就可以完成了一天的工作，剩下的时间一直持续到晚上睡觉，都是打游戏or看电影/连续剧中度过。
我曾经理想的remote状态是，工作之余可以去旅游或者进行我的业余项目，一直到我的业余项目可以支撑起我的生活，
但是我太高估自己的自制力了，在那种极度自由和极多空余时间的remote工作下，我自己制定的目标也被懒惰一点一点侵蚀。
以至于后面我一度非常担心这样下去，会不会自己的技术就止步于此，感觉提前步入的退休的生活。。。&lt;/p&gt;

&lt;p&gt;在这样的担心下，我后面也答应了朋友的邀请，加入了现在这家创业公司。说实话，朋友第一次邀请我加入时我是一点也不感兴趣，
原因在于，我给自己定了一个规矩，不加入那些土老板+传统管理制度的公司，因为我实在无法接受这些“压榨制度”，
后面朋友一再承诺，老板会放权给他管理我们技术部门，我才加入了他们，负责技术架构以及带我们技术团队。
和很多创业公司一样，后面半年一直处于疯狂加班上线的状态。朋友的承诺没多久也成一句空谈，打卡，
要求我尽可能分配多任务给下属，让他们多加班给老板看。这也一度让我深思，深思为什么会这样，
我真的无法接受这种无意义的作秀。我和朋友的管理方式，有着诸多冲突，真的让我有点不适应，孰对孰错，待明年再来判定。&lt;/p&gt;

&lt;p&gt;今年写了几个lib，但是star都不多，哎，我的100个star的项目何时才能实现。&lt;/p&gt;

&lt;p&gt;人就是这么奇怪，闲的时候想忙一点，忙的时候又想闲一点，今年似乎就是一个这么轮回。&lt;/p&gt;

&lt;p&gt;展望明年，让自己归零，重新学习管理团队，重新上路。&lt;/p&gt;

&lt;h2 id=&#34;生活&#34;&gt;生活&lt;/h2&gt;

&lt;p&gt;今年的生活过得太差了，原本和朋友定好今年6月去泰国学潜水，由于工作的原因，没能成行，太遗憾了。
运动量比之前差了好多个量级，基本都没运动了，公司周围没有运动的地方，之前在唯品会的时候还能跑跑步，
在这边就只能在公司里走动走动了。&lt;/p&gt;

&lt;p&gt;今年体检的时候，测出了一个绝症&amp;mdash;慢性咽喉炎，上网搜了下，这个病无法根治，我又不抽烟，不知道是广州的空气差了，
还是我的过敏性鼻炎引起的。今年买了房子，看看明年能不能装修好搬过去住，在小区里起码还可以跑跑步。
身体是革命的本钱，丢了身体赚再多钱也是徒劳。&lt;/p&gt;

&lt;p&gt;展望明年，多运动，实在不行就买点健身器材丢在公司里；去一次旅游，这次辞职都要去，谁都不能阻止我了；
如果还能有点闲钱买车就好了；&lt;/p&gt;

&lt;h2 id=&#34;投资&#34;&gt;投资&lt;/h2&gt;

&lt;p&gt;今年的收益不佳，只有5%，基本上都是靠中国核建这个新股的收益支撑的。
今年后半年开始，发新股的频率越来越快，A股也在快速扩容，真应了那句话，“垃圾股无限供应，蓝筹股就这么几支”，
未来行情可能就要转向蓝筹了。&lt;/p&gt;

&lt;p&gt;展望明年，上次5000点之后，不知道又要横盘到什么时候了，明年逢高减持，网格交易，继续打新。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>迟到的2015总结</title>
      <link>http://barbery.me/post/2016-02-15-%E8%BF%9F%E5%88%B0%E7%9A%842015%E6%80%BB%E7%BB%93/</link>
      <pubDate>Mon, 15 Feb 2016 17:47:48 +0000</pubDate>
      
      <guid>http://barbery.me/post/2016-02-15-%E8%BF%9F%E5%88%B0%E7%9A%842015%E6%80%BB%E7%BB%93/</guid>
      <description>

&lt;h2 id=&#34;工作&#34;&gt;工作&lt;/h2&gt;

&lt;p&gt;今年在工作上真是折腾不少，回顾今年，主要做了以下几点值得一谈的事情&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;基本完成了微信活动开发的框架，可以大部分的复用活动逻辑，这个框架的建成，提高了活动开发效率，可以应对公司大促时带来的活动开发的压力。&lt;/li&gt;
&lt;li&gt;在部门推广vagrant统一团队开发环境，统一我们微信组的开发环境&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;进入8月份后，部门整合，微信组要被拆分成2部分合并到其他组里面去，导致多名同事出走，考虑到晋升的不稳定因素太多，我也决定出走，并于11月从VIP离职。今年在VIP的时光真的很开心，可以说是我目前为止职业生涯中最快乐的一段时光。我记得15年过完春节回来上班不久，我们组的工位就从移动楼2楼搬迁到图书馆的小房间里面，大家在小房间内一起加班，一起开黑，一起吃下午茶，我真的很享受小团队这种感觉。。。&lt;/p&gt;

&lt;p&gt;离开VIP后，我加盟一家remote的小公司。自从看了《rework2》之后，就一直对remote这种工作方式很憧憬，很想尝试一下。距离目前为止，我已从事remote的工作3个月了，刚开始的时候还是挺不适应的，觉得好累，因为没有客观的上下班时间，虽然自己规定了工作时间，但是人就是懒惰，总想着把工作往后推，这就导致了工作时间效率不高，本该休息的时间，却被拿来赶工作，所以感觉就好累，好像创业一样，感觉一直都在上班。。。&lt;/p&gt;

&lt;p&gt;回顾去年的工作总结中的期望，今年没能完成一个100 star的开源项目，所以今年继续继承这个期望，希望能做出些有价值的开源项目。。。&lt;/p&gt;

&lt;h2 id=&#34;生活&#34;&gt;生活&lt;/h2&gt;

&lt;p&gt;今年在生活上比较顺利，去了马来西亚和越南旅游，在VIP的时候，常常和同事去跑步，游泳。不过最近加入remote后，有更宅的倾向，所以今年的目标是多运动，多出去外面走走，多社交朋友。&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h2 id=&#34;投资&#34;&gt;投资&lt;/h2&gt;

&lt;p&gt;今年上半年，走了一波小牛市，可惜活生生坐了一次过山车，『会买是徒弟，会卖才是师傅』终于体会到这句话的涵义了。&lt;/p&gt;

&lt;p&gt;2015年的投资收益率为25%，虽然不高，但是我对这个收益率还是挺满意的。&lt;/p&gt;

&lt;p&gt;对于明年的期望，策略主要以谨慎为主，被动补仓。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>2014年总结</title>
      <link>http://barbery.me/post/2014-12-31-2014%E5%B9%B4%E6%80%BB%E7%BB%93/</link>
      <pubDate>Wed, 31 Dec 2014 22:25:46 +0000</pubDate>
      
      <guid>http://barbery.me/post/2014-12-31-2014%E5%B9%B4%E6%80%BB%E7%BB%93/</guid>
      <description>

&lt;h2 id=&#34;工作&#34;&gt;工作&lt;/h2&gt;

&lt;p&gt;先说说今年的工作情况吧。。年初激情四射，和几位好朋友，满腔热火，砸锅卖铁去创业，势必把O2O果汁店这个idea给做起来。年中，资金耗完，团队各种困难，股东退出，也没洽谈到融资，各种矛盾不如意，最终只能关掉项目，各种各路。回想这次“创业”，有太多不成熟的地方了，首先低估了营销的重要性和难度，其次O2O不是我们的专长，这种需要结合线下推广的业务，我们无一擅长，纯互联网的项目才是我们的主场。也许，我们应该先开果汁店，成功了再O2O，网络只是销售渠道的一个，而不是本末倒置，先做网络，再卖果汁。&lt;/p&gt;

&lt;p&gt;项目失败后，我也一度失去了奋斗的方向，9月份开始，又重新踏上打工的道路，也顺利拿下了许多offer，经过考虑，最终选择了进入唯品会，一边工作积累技术，一边好好考虑，究竟自己想要什么，我憧憬的未来是怎么样的？&lt;/p&gt;

&lt;p&gt;对于15年的展望，努力工作，多写代码，争取做出一个超100个star的开源项目。&lt;/p&gt;

&lt;h2 id=&#34;生活&#34;&gt;生活&lt;/h2&gt;

&lt;p&gt;工作之余，貌似我的生活也太枯燥无味了，平时也不喜欢出去逛，除了有同学/朋友聚会什么的。平时生活的最大乐趣就数去旅游了，每年一度的旅游计划，是属于我自己最盛大的节日了，2014年去了一趟泰国游，现在回想起来，真是爽爆了~。&lt;/p&gt;

&lt;p&gt;自从来了唯品会，偶尔也跟同事跑跑步什么的，坚持运动，健康生活。对于15年的展望，我想说：猿的生命短暂，说不准何时就猝死了，不要浪费自己的时光，也不要只关注自己的工作，多关心朋友、亲人，以后要多点提高自己的生活质量，每天都快乐的活着。&lt;/p&gt;

&lt;p&gt;写完这个计划，我又要开始策划我15年的年度旅游了，哈哈哈，太激动鸟~~&lt;/p&gt;

&lt;h2 id=&#34;投资&#34;&gt;投资&lt;/h2&gt;

&lt;p&gt;最后说说投资吧，真是对不起乡亲父老，今年的上半年都在和朋友创业，除了没收入，没钱继续买股票之前，还要变卖股票，套现一点钱出来维持生活费的开支，以至于后面大涨，我只能感叹再也没有便宜股买了。。。&lt;/p&gt;

&lt;p&gt;今年的总收益率为53%左右，对比上证指数，跑输2%，对比上证50指数，跑输15%。收益竟然还不及我姐姐的账户，我姐姐的账户也是由我操作，风格上和我集中持股不同，比较分散，持有的行业比重最大为银行股，其次为建筑地产，最后为高速铁路，不同行业组合，加上轮涨，反倒成了不错的组合收益。&lt;/p&gt;

&lt;p&gt;自己总结下跑输的原因：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;下半年突然风格转为牛市，持仓上非常保守，都是高股息的银行股，并没有持有具有牛市大杀器证券股或者保险股；&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;持仓过于集中于一个行业，对于上涨通常都是行业之间轮换的上涨，由于太集中，没办法像其他人那样通过换股操作提高收益率；&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;没有融资，没上杠杆；&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;不管怎么样都好，永远不要忘了自己的出发点，融资这样高风险的事情必须谨慎再谨慎，我不是想通过股市发大财，只是希望可以好好理财，赚点小钱。&lt;/p&gt;

&lt;p&gt;对于15年的投资展望，如果继续上涨，就不再追高买入，转为打新和分级套利操作，两股没有相差30%以上的差价，都不考虑换股的事情。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>2013年总结</title>
      <link>http://barbery.me/post/2014-01-04-2013%E5%B9%B4%E6%80%BB%E7%BB%93/</link>
      <pubDate>Sat, 04 Jan 2014 20:56:00 +0000</pubDate>
      
      <guid>http://barbery.me/post/2014-01-04-2013%E5%B9%B4%E6%80%BB%E7%BB%93/</guid>
      <description>

&lt;p&gt;今年的总结，简单点说，就是各种不如意。。。&lt;/p&gt;

&lt;h1 id=&#34;工作&#34;&gt;工作&lt;/h1&gt;

&lt;p&gt;工作的话，今年真的非常折腾。。。先是过年上来找工作，找了1个多月，再是加入别人一起创业折戟沉沙，现今也只能蜗居在一家小公司之中。。。&lt;/p&gt;

&lt;p&gt;关于第一家公司的失败，我只能说出乎意料又在情理之中。。。出乎意料在于，我们的技术BOSS作为那么有经验的人，况且他做的上一个项目才大获全胜，为何会如此疏于工作。。情理之中在于，如此的管理和交流，想不失败都难。。。你可以想象，没有业务逻辑沟通的开发么？沟通太少，特别是业务逻辑上的沟通更是少得可怜，以至于开发过程只能借鉴同行的一些功能和体验来做，后期更为严重，以至于要猜测，业务上是不是要这样做。。。&lt;/p&gt;

&lt;p&gt;关于第一家公司，我还是非常认同它的，而且公司方面对我们也非常人性化，可以说尽可能提供最好的工作环境。。。我真心觉得成功几率非常大的，真是事与愿违。。。哎，只能说大家保重。。。&lt;/p&gt;

&lt;p&gt;关于现在这家公司，我一直都有个疑问，就是“我为什么要来这家公司？”，每当我的好友问我的时候，我都不知道怎么回答。。。你说我看好他们的业务吗？也不是，和第一家比较，差很多，反正我不是很认同，我觉得比较难做起来。。。你说我看好他们的管理，团队氛围么？也不是，我觉得他们根本不懂互联网的感觉。。。我为什么要来这家公司？现在回想起来的话，我只能说。。。我当时面试的时候，上个项目才刚散伙不久，我就像刚失恋的人遇到的新的恋情那样，鬼使神差的就选择了这家公司。。。&lt;/p&gt;

&lt;p&gt;关于今年的工作情况，我觉得我学到的是，要做leader，是不是做着指手画脚的BOSS，要真心待员工好，你可以给不起高工资，但是你最起码要真心识他为伙伴来看待。。。打工毕竟是打工，要找到自己认可的项目，又可以得到别人赏识的机会实在太少，找不到就只能自己做。。。业余项目也是一个程序员的自我修养。。。&lt;/p&gt;

&lt;p&gt;对于2014年的期待是，把ishgo项目超预期完成，把它做成自己喜欢的产品。。。&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h1 id=&#34;投资&#34;&gt;投资&lt;/h1&gt;

&lt;p&gt;投资上，今年可谓损失惨重。。。应该说实行价值投资以来，第一次跑输大市。。。今年沪市和沪深300下跌7个多点，而账户损失为10个多点，跑输大市3个多点。。。今年市场反复无常，拆借利率暴涨，加上民间资金成本高涨，市场固定收益类产品收益高了，自然也就没人玩股票了。。。但是我们这些穷屌丝，木有雄厚的资金也只能玩玩股票了，但是也不用妄自菲薄，要相信物极必反。&lt;/p&gt;

&lt;p&gt;对于2014年投资的期待是，保留现金，做好熊市的准备，只有亏损20%以上才能加仓。。。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>