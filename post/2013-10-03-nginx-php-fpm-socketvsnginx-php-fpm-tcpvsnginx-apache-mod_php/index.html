<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>NGINX&#43;PHP-FPM&#43;SOCKET VS NGINX&#43;PHP-FPM&#43;TCP VS NGINX&#43;APACHE&#43;MOD_PHP - Barbery&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
  
  <meta name="description" content="上一篇果然nginx使用socket来与php-fpm通讯是更高效率中，测试了nginx 使用TCP与socket与php-fpm通讯的情况。">
  
  <meta itemprop="name" content="NGINX&#43;PHP-FPM&#43;SOCKET VS NGINX&#43;PHP-FPM&#43;TCP VS NGINX&#43;APACHE&#43;MOD_PHP - Barbery&#39;s Blog">
  <meta itemprop="description" content="上一篇果然nginx使用socket来与php-fpm通讯是更高效率中，测试了nginx 使用TCP与socket与php-fpm通讯的情况。">
  <meta itemprop="image" content="https://barbery.me/img/author.jpg">
  
  
  <meta name="twitter:description" content="">
  
  <link rel="shortcut icon" href="https://barbery.me/img/favicon.ico"/>
  <link rel="apple-touch-icon" href="https://barbery.me/apple-touch-icon.png" />
  <link rel="apple-touch-icon-precomposed" href="https://barbery.me/apple-touch-icon.png" />
  <link rel="stylesheet" href="https://barbery.me/highlight/styles/github.css">
  <script src="https://barbery.me/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <link rel="stylesheet" href="https://barbery.me/font/hack/css/hack.min.css">
  <link rel="stylesheet" href="https://barbery.me/css/style.css">
  <script data-ad-client="ca-pub-7149935706066429" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<body>
  <header>
    <div>
  
  <div id="textlogo">
    <h1 class="site-name"><a href="https://barbery.me/" title="Barbery&#39;s Blog">Barbery&#39;s Blog</a></h1>
    <h2 class="blog-motto">夫君子之行，静以修身，俭以养德。非淡泊无以明志，非宁静无以致远。夫学须静也，才须学也</h2>
  </div>
  <div class="navbar"><a class="navbutton navmobile" href="#" title="menu"></a></div>
  <div class="social-font clearfix">
  
  <a href="http://weibo.com/stutostu" target="_blank" title="weibo"></a>
  
  
  
  <a href="https://github.com/Barbery" target="_blank" title="github"></a>
  
  
  
  <a href="https://cn.linkedin.com/in/BarberyXie" target="_blank" title="linkedin"></a>
  
</div>
  <nav class="animated">
    <ul>
      
      <li><a href="/">home</a></li>
      
      <li><a href="/about">about</a></li>
      
      <li><a href="/link">link</a></li>
      
      <li>
        <form class="search" method="get" action="https://www.google.com/search">
          <div>
            <input type="text" id="search" name="q" placeholder="search">
          </div>
        </form>
      </li>
    </ul>
  </nav>
</div>

  </header>
  <div id="container">
    <div id="main" class="post" itemscope itemprop="blogPost" style="width:100%;">
	<article itemprop="articleBody">
    <header class="article-info clearfix">
  <h1 itemprop="name">
      <a href="https://barbery.me/post/2013-10-03-NGINX-PHP-FPM-SOCKETVSNGINX-PHP-FPM-TCPVSNGINX-APACHE-MOD_PHP/" title="NGINX&#43;PHP-FPM&#43;SOCKET VS NGINX&#43;PHP-FPM&#43;TCP VS NGINX&#43;APACHE&#43;MOD_PHP" itemprop="url">NGINX&#43;PHP-FPM&#43;SOCKET VS NGINX&#43;PHP-FPM&#43;TCP VS NGINX&#43;APACHE&#43;MOD_PHP</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://barbery.me" title=""></a>
    
  </p>
  <p class="article-time">
    <time datetime="2013-10-03 17:02:45 &#43;0000 &#43;0000" itemprop="datePublished">2013年10月03日</time>
  </p>
</header>

	<div class="article-content">
    
    

<p>上一篇<a href="http://www.stutostu.com/?p=1225">果然nginx使用socket来与php-fpm通讯是更高效率</a>中，测试了nginx 使用TCP与socket与php-fpm通讯的情况。。。</p>

<p>今天把apache给搞点了，正好验证下，究竟是NGINX+PHP-FPM效率好还是NGINX+APACHE+mod_php 效率好。。。</p>

<p>立即开搞，看ab测试记录。。。</p>

<h2 id="for-1000次累加测试">for 1000次累加测试</h2>

<pre><code>barbery@xie:~$ ab -c 500 -n 10000 http://localhost/bench/foreach_test.php
This is ApacheBench, Version 2.3 &lt;$Revision: 655654 $&gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/
Benchmarking localhost (be patient)
Completed 1000 requests
Completed 2000 requests
Completed 3000 requests
Completed 4000 requests
Completed 5000 requests
Completed 6000 requests
Completed 7000 requests
Completed 8000 requests
Completed 9000 requests
Completed 10000 requests
Finished 10000 requests
Server Software:        ngx_openresty/1.4.2.7
Server Hostname:        localhost
Server Port:            80
Document Path:          /bench/foreach_test.php
Document Length:        8 bytes
Concurrency Level:      500
Time taken for tests:   18.643 seconds
Complete requests:      10000
Failed requests:        218
   (Connect: 0, Receive: 0, Length: 218, Exceptions: 0)
Write errors:           0
Non-2xx responses:      218
Total transferred:      2187686 bytes
HTML transferred:       117932 bytes
Requests per second:    536.38 [#/sec] (mean)
Time per request:       932.173 [ms] (mean)
Time per request:       1.864 [ms] (mean, across all concurrent requests)
Transfer rate:          114.59 [Kbytes/sec] received
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    3  42.4      0    1000
Processing:    48  486 1895.6     99   14013
Waiting:       30  486 1895.6     99   14013
Total:         66  489 1899.5    100   14013
Percentage of the requests served within a certain time (ms)
  50%    100
  66%    107
  75%    113
  80%    120
  90%    153
  95%   1106
  98%   8848
  99%  12481
 100%  14013 (longest request)
</code></pre>

<h2 id="mysql-select数据测试">mysql select数据测试</h2>

<pre><code>barbery@xie:~$ ab -c 500 -n 10000 http://localhost/bench/mysql_test.php
This is ApacheBench, Version 2.3 &lt;$Revision: 655654 $&gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/
Benchmarking localhost (be patient)
Completed 1000 requests
Completed 2000 requests
Completed 3000 requests
Completed 4000 requests
Completed 5000 requests
Completed 6000 requests
Completed 7000 requests
Completed 8000 requests
Completed 9000 requests
Completed 10000 requests
Finished 10000 requests
Server Software:        ngx_openresty/1.4.2.7
Server Hostname:        localhost
Server Port:            80
Document Path:          /bench/mysql_test.php
Document Length:        462 bytes
Concurrency Level:      500
Time taken for tests:   14.451 seconds
Complete requests:      10000
Failed requests:        229
   (Connect: 0, Receive: 0, Length: 229, Exceptions: 0)
Write errors:           0
Non-2xx responses:      229
Total transferred:      6644659 bytes
HTML transferred:       4555880 bytes
Requests per second:    691.98 [#/sec] (mean)
Time per request:       722.565 [ms] (mean)
Time per request:       1.445 [ms] (mean, across all concurrent requests)
Transfer rate:          449.02 [Kbytes/sec] received
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    1   3.1      0      22
Processing:    84  600 2459.8    112   14425
Waiting:       84  600 2459.8    112   14425
Total:         84  601 2461.9    112   14439
Percentage of the requests served within a certain time (ms)
  50%    112
  66%    119
  75%    124
  80%    129
  90%    147
  95%   1105
  98%  14385
  99%  14390
 100%  14439 (longest request)
</code></pre>

<hr />

<h2 id="总结">总结</h2>

<p>为了更好的对比结果，我做了一个表格，成绩对比如下：</p>

<p><img src="http://ww3.sinaimg.cn/large/6915c7dcgw1e983aheg9lj20la07sjsl.jpg" /></p>

<p>使用NGINX+PHP-FPM+TCP 和 NGINX+APACHE+MOD_PHP的测试结果不相上下。。。这个和网上各位博主测出来的结果相差不大。。。</p>

<p><a href="http://www.eschrade.com/page/why-is-fastcgi-w-nginx-so-much-faster-than-apache-w-mod_php/">http://www.eschrade.com/page/why-is-fastcgi-w-nginx-so-much-faster-than-apache-w-mod_php/</a>这个博主就测出来，在关闭APACHE AllowOverride 可以获得性能上的提升，可以比NGINX+PHP-FPM+TCP高10～15%这样。。。比较可惜的是，该博主没有测使用NGINX+PHP-FPM+SOCKET的模式，也没有使用NIGNX+APACHE做方向代理的模式。。。</p>

<p>最后，这次的测试都在默认配置下进行，不排除NIGNX和APACHE在默认配置上的差异，导致结果悬殊。。但是，即便存在上述可能，NGINX+PHP-FPM+SOCKET的模式比NGINX+APACHE的测试结果高出10倍之多。。。差距如此之大也可以说明，NGINX+PHP-FPM+SOCKET才是王道。。。</p>

<p>如果你有不同的意见，欢迎交流。。。</p>

<p>PHP测试脚本：<a href="https://github.com/Barbery/blog/tree/master/bench">https://github.com/Barbery/blog/tree/master/bench</a></p>

	</div>
  <footer class="article-footer clearfix">
  

<div class="article-tags">
  <span></span>
  
  <a href="https://barbery.me/tags/APACHE">APACHE</a>
  
  <a href="https://barbery.me/tags/MOD_PHP">MOD_PHP</a>
  
  <a href="https://barbery.me/tags/nginx">nginx</a>
  
  <a href="https://barbery.me/tags/PHP-FPM">PHP-FPM</a>
  
</div>





<div class="article-categories">
  <span></span>
  
  <a class="article-category-link" href="https://barbery.me/categories/%E5%BC%80%E5%8F%91">开发</a>
  
</div>



  <div class="article-share" id="share">
    <div data-url="https://barbery.me/post/2013-10-03-NGINX-PHP-FPM-SOCKETVSNGINX-PHP-FPM-TCPVSNGINX-APACHE-MOD_PHP/" data-title="NGINX&#43;PHP-FPM&#43;SOCKET VS NGINX&#43;PHP-FPM&#43;TCP VS NGINX&#43;APACHE&#43;MOD_PHP" data-tsina="" class="share clearfix">
    </div>
  </div>
</footer>

	</article>
  


<section class="comment">
<div id="disqus_thread"></div>
</section>
<script>


var disqus_config = function () {
this.page.url = "https://barbery.me/post/2013-10-03-NGINX-PHP-FPM-SOCKETVSNGINX-PHP-FPM-TCPVSNGINX-APACHE-MOD_PHP/";
this.page.identifier = "https://barbery.me/post/2013-10-03-NGINX-PHP-FPM-SOCKETVSNGINX-PHP-FPM-TCPVSNGINX-APACHE-MOD_PHP/";
};
(function() { 
var d = document, s = d.createElement('script');

s.src = '//barbery.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</div>

  </div>
  <footer><div id="footer" >
  
  
  <p class="copyright">Powered by <a href="http://gohugo.io" target="_blank" title="hugo">hugo</a> and Theme by <a href="https://github.com/coderzh/hugo-pacman-theme" target="_blank" title="hugo-pacman-theme">hugo-pacman-theme</a> © 2020
    
    <a href="https://barbery.me/" title="Barbery&#39;s Blog">Barbery&#39;s Blog</a>
    
  </p>
</div>
</footer>
  <script src="https://barbery.me/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
done = false;
$(document).ready(function(){
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  $('form.search').on('submit', function (event) {
    if (false === done) {
      event.preventDefault();
      var orgVal = $(this).find('#search').val();
      $(this).find('#search').val('site:https:\/\/barbery.me\/ ' + orgVal);
      done = true;
      $(this).submit();
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});
</script>


<link rel="stylesheet" href="https://barbery.me/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="https://barbery.me/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
});
</script>




</body>
</html>
