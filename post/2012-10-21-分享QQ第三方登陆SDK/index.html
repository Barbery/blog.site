<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>分享QQ第三方登陆SDK - Barbery&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
  
  <meta name="description" content="主要是考虑到QQ的PHP SDK写的真是太烂了，纯属是普及API知识，而不是到手就可以部署的类库。。反正自己都写了一个了，就拿出来分享下。。 什">
  
  <meta itemprop="name" content="分享QQ第三方登陆SDK - Barbery&#39;s Blog">
  <meta itemprop="description" content="主要是考虑到QQ的PHP SDK写的真是太烂了，纯属是普及API知识，而不是到手就可以部署的类库。。反正自己都写了一个了，就拿出来分享下。。 什">
  <meta itemprop="image" content="https://barbery.me/img/author.jpg">
  
  
  <meta name="twitter:description" content="">
  
  <link rel="shortcut icon" href="https://barbery.me/img/favicon.ico"/>
  <link rel="apple-touch-icon" href="https://barbery.me/apple-touch-icon.png" />
  <link rel="apple-touch-icon-precomposed" href="https://barbery.me/apple-touch-icon.png" />
  <link rel="stylesheet" href="https://barbery.me/highlight/styles/github.css">
  <script src="https://barbery.me/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <link rel="stylesheet" href="https://barbery.me/font/hack/css/hack.min.css">
  <link rel="stylesheet" href="https://barbery.me/css/style.css">
</head>

<body>
  <header>
    <div>
  
  <div id="textlogo">
    <h1 class="site-name"><a href="https://barbery.me/" title="Barbery&#39;s Blog">Barbery&#39;s Blog</a></h1>
    <h2 class="blog-motto">夫君子之行，静以修身，俭以养德。非淡泊无以明志，非宁静无以致远。夫学须静也，才须学也</h2>
  </div>
  <div class="navbar"><a class="navbutton navmobile" href="#" title="menu"></a></div>
  <div class="social-font clearfix">
  
  <a href="http://weibo.com/stutostu" target="_blank" title="weibo"></a>
  
  
  
  <a href="https://github.com/Barbery" target="_blank" title="github"></a>
  
  
  
  <a href="https://cn.linkedin.com/in/BarberyXie" target="_blank" title="linkedin"></a>
  
</div>
  <nav class="animated">
    <ul>
      
      <li><a href="/">home</a></li>
      
      <li><a href="/about">about</a></li>
      
      <li><a href="/link">link</a></li>
      
      <li>
        <form class="search" method="get" action="https://www.google.com/search">
          <div>
            <input type="text" id="search" name="q" placeholder="search">
          </div>
        </form>
      </li>
    </ul>
  </nav>
</div>

  </header>
  <div id="container">
    <div id="main" class="post" itemscope itemprop="blogPost" style="width:100%;">
	<article itemprop="articleBody">
    <header class="article-info clearfix">
  <h1 itemprop="name">
      <a href="https://barbery.me/post/2012-10-21-%E5%88%86%E4%BA%ABQQ%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E9%99%86SDK/" title="分享QQ第三方登陆SDK" itemprop="url">分享QQ第三方登陆SDK</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://barbery.me" title=""></a>
    
  </p>
  <p class="article-time">
    <time datetime="2012-10-21 22:03:00 &#43;0000 &#43;0000" itemprop="datePublished">2012年10月21日</time>
  </p>
</header>

	<div class="article-content">
    
    <p>主要是考虑到QQ的PHP SDK写的真是太烂了，纯属是普及API知识，而不是到手就可以部署的类库。。反正自己都写了一个了，就拿出来分享下。。</p>

<p>什么也不多说，直接上代码。</p>

<p>Qq_sdk.php</p>

<pre><code class="language-php">&lt;?php
/**
* QQ开发平台 SDK
* 作者：偶尔陶醉
* blog: www.stutostu.com
*/

class Qq_sdk{

    //配置APP参数
    private $app_id     = 你的APP ID;
    private $app_secret = '你的APP_secret';
    private $redirect   = 你的回调地址;

    function __construct()
    {

    }

    /**
     * [get_access_token  获取access_token]
     * @param  [string] $code [登陆后返回的$_GET['code']]
     * @return [array] [expires_in 为有效时间 , access_token 为授权码 ; 失败返回 error , error_description ]
     */
    function get_access_token($code)
    {
        //获取access_token
        $token_url = 'https://graph.qq.com/oauth2.0/token?grant_type=authorization_code&amp;'
            . 'client_id=' . $this-&gt;app_id . '&amp;redirect_uri=' . urlencode($this-&gt;redirect)//回调地址
            . '&amp;client_secret=' . $this-&gt;app_secret . '&amp;code=' . $code;
        $token =  array();
        //expires_in 为access_token 有效时间增量
        parse_str($this-&gt;_curl_get_content($token_url), $token);

        return $token;
    }

    /**
     * [get_open_id 获取用户唯一ID，openid]
     * @param  [string] $token [授权码]
     * @return [array] [成功返回client_id 和 openid ;失败返回error 和 error_msg]
     */
    function get_open_id($token)
    {
        $str = $this-&gt;_curl_get_content('https://graph.qq.com/oauth2.0/me?access_token=' . $token);
        if (strpos($str, &quot;callback&quot;) !== false)
        {
            $lpos = strpos($str, &quot;(&quot;);
            $rpos = strrpos($str, &quot;)&quot;);
            $str  = substr($str, $lpos + 1, $rpos - $lpos -1);
        }
        $user = json_decode($str, TRUE);

        return $user;
    }

    /**
     * [get_user_info 获取用户信息]
     * @param  [string] $token   [授权码]
     * @param  [string] $open_id [用户唯一ID]
     * @return [array]          [ret：返回码，为0时成功。msg为错误信息,正确返回时为空。...params]
     */
    function get_user_info($token, $open_id)
    {

        //组装URL
        $user_info_url = 'https://graph.qq.com/user/get_use
r_info?'
            . 'access_token=' . $token
            . '&amp;oauth_consumer_key=' . $this-&gt;app_id
            . '&amp;openid=' . $open_id
            . '&amp;format=json';

        $info = json_decode($this-&gt;_curl_get_content($user_info_url), TRUE);

        return $info;
    }

    private function _curl_get_content($url)
    {
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
        curl_setopt($ch, CURLOPT_URL, $url);
        //设置超时时间为3s
        curl_setopt ($ch, CURLOPT_CONNECTTIMEOUT, 3);
        $result = curl_exec($ch);
        curl_close($ch);

        return $result;
    }

}

/* end of Qq_sdk.php */
</code></pre>

<p>使用方法：在你网站上放置超链接，地址为：<a href="https://graph.qq.com/oauth2.0/authorize?response_type=code&amp;client_id=你的APP_ID&amp;redirect_uri=你的回调地址">https://graph.qq.com/oauth2.0/authorize?response_type=code&amp;client_id=你的APP_ID&amp;redirect_uri=你的回调地址</a></p>

<p>在回调地址上调用我上面这个qq_sdk即可。</p>

<p>demo如下：</p>

<pre><code class="language-php">if(empty($_GET['code']))
{
    exit('参数非法');
}

include('qq_sdk');
$qq_sdk = new Qq_sdk();
$token = $qq_sdk-&gt;get_access_token($_GET['code']);
print_r($token);

$open_id = $qq_sdk-&gt;get_open_id($token['access_token']);
print_r($open_id);


$user_info = $qq_sdk-&gt;get_user_info($token['access_token'], $open_id['openid']);
print_r($user_info);
</code></pre>

	</div>
  <footer class="article-footer clearfix">
  

<div class="article-tags">
  <span></span>
  
  <a href="https://barbery.me/tags/QQ">QQ</a>
  
  <a href="https://barbery.me/tags/SDK">SDK</a>
  
</div>





<div class="article-categories">
  <span></span>
  
  <a class="article-category-link" href="https://barbery.me/categories/%E5%BC%80%E5%8F%91">开发</a>
  
</div>



  <div class="article-share" id="share">
    <div data-url="https://barbery.me/post/2012-10-21-%E5%88%86%E4%BA%ABQQ%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E9%99%86SDK/" data-title="分享QQ第三方登陆SDK" data-tsina="" class="share clearfix">
    </div>
  </div>
</footer>

	</article>
  


<section class="comment">
<div id="disqus_thread"></div>
</section>
<script>


var disqus_config = function () {
this.page.url = "https://barbery.me/post/2012-10-21-%E5%88%86%E4%BA%ABQQ%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E9%99%86SDK/";
this.page.identifier = "https://barbery.me/post/2012-10-21-%E5%88%86%E4%BA%ABQQ%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E9%99%86SDK/";
};
(function() { 
var d = document, s = d.createElement('script');

s.src = '//barbery.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</div>

  </div>
  <footer><div id="footer" >
  
  
  <p class="copyright">Powered by <a href="http://gohugo.io" target="_blank" title="hugo">hugo</a> and Theme by <a href="https://github.com/coderzh/hugo-pacman-theme" target="_blank" title="hugo-pacman-theme">hugo-pacman-theme</a> © 2019
    
    <a href="https://barbery.me/" title="Barbery&#39;s Blog">Barbery&#39;s Blog</a>
    
  </p>
</div>
</footer>
  <script src="https://barbery.me/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
done = false;
$(document).ready(function(){
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  $('form.search').on('submit', function (event) {
    if (false === done) {
      event.preventDefault();
      var orgVal = $(this).find('#search').val();
      $(this).find('#search').val('site:https:\/\/barbery.me\/ ' + orgVal);
      done = true;
      $(this).submit();
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});
</script>


<link rel="stylesheet" href="https://barbery.me/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="https://barbery.me/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
});
</script>




</body>
</html>
